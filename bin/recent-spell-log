KRYPTONITE_HOST="krygw1022.inktomisearch.com"

# Get yesterday's year, month, and day, and see if any such logs exist.
YEARMONTH=`date --date "yesterday" +"%Y-%m"`
YEARMONTHDAY=`date --date "yesterday" +"%Y-%m-%d"`
FILELINE=`ssh $KRYPTONITE_HOST "hadoop dfs -ls /projects/spelling/logs/cleaned/$YEARMONTH/$YEARMONTHDAY/" | grep "proxy-$YEARMONTHDAY.clean" | random-line.pl`

# If yesterday's logs aren't uploaded yet, try two days ago.
if [ -z "$FILELINE" ]
then
    YEARMONTH=`date --date "2 days ago" +"%Y-%m"`
    YEARMONTHDAY=`date --date "2 days ago" +"%Y-%m-%d"`
    FILELINE=`ssh $KRYPTONITE_HOST "hadoop dfs -ls /projects/spelling/logs/cleaned/$YEARMONTH/$YEARMONTHDAY/" | grep "proxy-$YEARMONTHDAY.clean" | random-line.pl`
fi

# If we still don't have any filename, error out.
if [ -z "$FILELINE" ]
then
    echo Error -- could not find any log files on the Kryptonite DFS.
    exit 1
fi

# Pick a random file and grab it from the server.
FILENAME=`echo $FILELINE | perl -ne '/^(\S+)/; print "$1\n";'`
ssh $KRYPTONITE_HOST "hadoop dfs -cat $FILENAME" | zcat
